# Update your docker-build.yml workflow triggers
name: Docker Build and Deploy

on:
  workflow_run:
    workflows: ["Tests", "SonarQube"] # Wait for both workflows
    types: [completed]
    branches: [main]
  workflow_dispatch: # Manual trigger for testing

jobs:
  check-prerequisites:
    name: Check Prerequisites
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_run'
    outputs:
      should_deploy: ${{ steps.check.outputs.should_deploy }}

    steps:
      - name: Check if all prerequisites passed
        id: check
        run: |
          if [[ "${{ github.event.workflow_run.conclusion }}" == "success" ]]; then
            echo "should_deploy=true" >> $GITHUB_OUTPUT
            echo "✅ Prerequisites passed, proceeding with deployment"
          else
            echo "should_deploy=false" >> $GITHUB_OUTPUT
            echo "❌ Prerequisites failed, skipping deployment"
          fi

  docker-build-and-push:
    name: Build and Push Docker Images
    runs-on: ubuntu-latest
    needs: [check-prerequisites]
    if: needs.check-prerequisites.outputs.should_deploy == 'true' || github.event_name == 'workflow_dispatch'
    # ... rest of your existing job
